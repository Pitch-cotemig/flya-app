name: üîç Verificar Pull Request

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  validate-pr:
    runs-on: ubuntu-latest
    steps:
      - name: üîé Verificar t√≠tulo da PR
        uses: actions/github-script@v7
        with:
          script: |
            const prTitle = context.payload.pull_request.title;
            const titleRegex = /^\[FLYA\] - .+/;

            if (!titleRegex.test(prTitle)) {
              core.setFailed("‚ùå O t√≠tulo da PR deve come√ßar com '[FLYA] - ' seguido de uma descri√ß√£o.");
            } else {
              console.log("‚úÖ T√≠tulo v√°lido");
            }

      - name: üìù Verificar se h√° descri√ß√£o na PR
        uses: actions/github-script@v7
        with:
          script: |
            const cleanedBody = body.replace(/<!--.*?-->/gs, "").trim();
            if (!cleanedBody || cleanedBody.length < 10) {
              core.setFailed("‚ùå A descri√ß√£o da PR est√° vazia ou cont√©m apenas coment√°rios.");
            } else {
              console.log("‚úÖ Descri√ß√£o v√°lida");
            }

      - name: ‚òëÔ∏è Verificar checklist marcado
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request.body;
            const checklistItems = [
              "- [x] Me atribu√≠ como respons√°vel por esta PR",
              "- [x] Resolvi conflitos de merge (se houver)",
              "- [x] A PR est√° seguindo o padr√£o de nomenclatura do t√≠tulo",
              "- [x] Atualizei/adicionei testes",
              "- [x] Revisei se h√° prints ou c√≥digos de debug para remover"
            ];

            const allChecked = checklistItems.every(item => body.includes(item));
            if (!allChecked) {
              core.setFailed("‚ùå Nem todos os itens obrigat√≥rios do checklist est√£o marcados.");
            } else {
              console.log("‚úÖ Checklist completo");
            }
